---
title : "置信度"
Layout : page
date : 2018-12-12 11:49
---

[TOC]

# 置信区间

置信度，置信区间

[拉伊达准则](https://baike.baidu.com/item/3%CF%83%E5%87%86%E5%88%99)：先假设一组检测数据只含有随机误差，对其进行计算处理得到标准偏差，按一定概率确定一个区间，认为凡超过这个区间的误差，就不属于随机误差而是粗大误差，含有该误差的数据应予以剔除。且3σ适用于有较多组数据的时候。



# AB测试合理性探究

算法工程师日常AB Test，分组测试有两个问题需要深入分析下：

- 初始实验的用户数，由于系统、渠道等的影响，到最终的实验用户往往会比初始的用户数少，存在一定的折损。那么折损后，AB Test的数据量是否合理。

- 当实验组有多少提高(增量)时才是有效地增量，而不是波动带来影响

| 实验分组    | 初始实验用户数 | 最终实验用户数 | 转化用户数 | 转化率 |
| ----------- | -------------- | -------------- | ---------- | ------ |
| A组(空白组) | 9000           | 8095           | 809        | 10%    |
| B组(实验组) | 1000           | 883            | 101        | 11.4%  |

为了方便解释，给出上述例子对数据进行分析，第一点，探讨最终实验用户数的合理性，第二点探讨转化率的提高的有效性。

## 一 实验用户数的合理性

原始实验设计，空白组和实验组的人数比例是$9:1$。现在得到最终用户总数是8095+883=8978 。理论上来说，空白组和实验组数量应该分别为 8080、898。我们知道，一个样本是否被选为实验组，是服从伯努利分布的，选中的总样本之间相互独立，可以得到理论上的实验组人数的方差$8978* 0.1 * 0.9=808$，标准差为28.4。

计算得到实验组人数的偏差为$|898-883|=15$，约等于0.53倍的标准差，依据拉伊达准则，是合理的。

`抽象数学过程`：

现在得到数据，统计可得 实验组人数为$M$，空白组为$N$，初始期望 `空白组人数/实验组人数=r`。

理论实验组人数为$\hat M=\frac{1}{{(1+r)}}(M+N)$

偏差为：$\Delta_M=|\hat M-M|$，理论标准差为$std=\sqrt{ \frac{r}{{(1+r)}^2}(M+N)}$。计算偏差和标准差的比值来判断数据的合理性。

其实可以为，依据中心极限定理，实验组人数服从$(\hat M,std^2)$的高斯分布。

## 二 增量的有效性

增量 =   r * 实验组支付人数 - 空白组支付人数。

可以计算得到增量为$101- 809/r=12$。

增量方差为：$std=\sqrt{8095*0.1*0.9/81+883*0.114*0.886)}=10.0$。

由上可知：**这个增量不是那么的有效**。

`抽象数学过程`:

增量的方差： Var(Add)
$$
Var(Add)=Var(-\sum _i^NX_i/r+\sum_j^MZ_j)\\\\
=Var(\sum _i^NX_i)/r^2+Var(\sum_j^MZ_j)\\\\
=Np_x(1-p_x)/r^2+Mp_z(1-p_z)
$$
如果$p_x,p_z​$ 很小，则上等式近似如下：
$$
Var(Add)=N_x/r^2+M_z
$$
$N_x$表示空白组支付人数，$M_z$表示实验组支付人数。那么可以计算得到 标准差（方差的开根号）。

如果增量>3 *增量的标准差。那么说明增量的是明显有效的（统计显著性）。类似于信号加上噪声，只有当信号强度远大于噪声时，信号受噪声的影响程度才会小。



# 标记重捕法问题



假设：池塘中N条标记，M条无标记，总共$Z=N+M$。捕捉了n条有标记，m条无标记，一共$z=n+m$条。估计池塘鱼的总数为：
$$
\hat Z=\frac {Nz}{n}
$$
那么：
$$
Var(n)=n\cdot p(1-p)=n\cdot \frac{n}{z}\cdot\frac{m}{z}
$$
所以n的标准差表示如下：
$$
std(n)=\sqrt{n\frac{mn}{(m+n)^2}} \approx \sqrt n
$$
对于$z​$来说：
$$
ln\hat Z=lnNz-\ln n
$$
求微分：
$$
|\frac{\Delta\hat Z}{\hat Z}|=|\frac{\Delta n}{n}|=\frac{std(n)}{n}
$$
**微分求偏差（标准差）~简直溜**



https://tracholar.github.io/machine%20learning/2018/11/02/abtest-and-sqrt-rule.html